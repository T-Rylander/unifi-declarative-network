# UniFi Network 9.5.21 + USG-3P Notes

These operational notes make the repo safe for 9.5.21 with USG-3P.

## Mandatory UI Step Before Script
- After adopting the USG-3P, immediately change the Default LAN to `10.0.1.0/27` in the controller UI.
- Do this before creating any VLANs. Managing VLAN 1 via API/config is error-prone and can break adoption.

## Configuration Rules
- VLAN 1 must not appear in `config/vlans.yaml`.
- The script keeps skip logic for `vlan_id == 1` and will not modify VLAN 1 unless explicit migration flags are used.
- The legacy bootstrap network must not use `vlan_id: 1`.

## Rationale
- UniFi 9.5.21 + USG-3P is sensitive to changes on the Default LAN during initial adoption.
- Setting `10.0.1.0/27` early ensures devices re-adopt cleanly and VLAN creation applies reliably.

## Sequence That Works
1. Factory reset all devices (default 192.168.1.0/24)
2. Fresh controller; complete wizard with a local admin (skip Ubiquiti login â†’ no 2FA)
3. Adopt USG-3P first
4. Change Default LAN to `10.0.1.0/27` in UI (mandatory)
5. Adopt switches/APs
6. Run the script
